{{ 'announcement-bar-slideshow.css' | asset_url | stylesheet_tag }}
<script src="{{ 'announcement-bar-slideshow.js' | asset_url }}" defer="defer"></script>

{% liquid
  assign container = section.settings.container
  if container == 'w-full'
    assign container = 'container-full'
  endif

  assign classes = 'm-section m-announcement-slideshow'
  if section.settings.custom_class != blank
    assign classes = classes | append: ' ' | append: section.settings.custom_class
  endif
  assign classes = classes | append: ' m-gradient' | append: ' m-color-' | append: section.settings.color_scheme
%}

<style>
  #m-announcement-slideshow--{{ section.id }} {
    --slideshow-height: {{ section.settings.height }}px;
    --text-size: {{ section.settings.text_size }}px;
    --transition-duration: {{ section.settings.transition_duration }}ms;
  }
  @media (max-width: 767px) {
    #m-announcement-slideshow--{{ section.id }} {
      --slideshow-height: {{ section.settings.height_mobile }}px;
      --text-size: {{ section.settings.text_size_mobile }}px;
    }
  }
</style>

{% if section.settings.show_slideshow %}
  {% if section.settings.homepage_only == false or request.page_type == 'index' %}
    <section
      id="m-announcement-slideshow--{{ section.id }}"
      data-section-id="{{ section.id }}"
      data-section-type="announcement-slideshow"
      class="{{ classes }}"
    >
      <m-announcement-slideshow
        data-autoplay="{{ section.settings.autoplay }}"
        data-autoplay-speed="{{ section.settings.autoplay_speed }}"
        data-transition="{{ section.settings.transition_effect }}"
        data-transition-duration="{{ section.settings.transition_duration }}"
      >
        <div class="{{ container }}">
          <div class="m-announcement-slideshow__wrapper">
            <div class="m-announcement-slideshow__slides" data-slides-container>
              {% for block in section.blocks %}
                <div class="m-announcement-slideshow__slide{% if forloop.first %} active{% endif %}"
                     data-slide="{{ forloop.index0 }}"
                     style="{% if block.settings.background_color != blank %}background-color: {{ block.settings.background_color }};{% endif %}">
                  <div class="m-announcement-slideshow__content">
                    {% if block.settings.link != blank %}
                      <a href="{{ block.settings.link }}" class="m-announcement-slideshow__link">
                    {% endif %}
                    
                    <div class="m-announcement-slideshow__inner">
                      {% if block.settings.icon != blank %}
                        <span class="m-announcement-slideshow__icon">
                          {{ block.settings.icon }}
                        </span>
                      {% endif %}
                      
                      {% if block.settings.title != blank %}
                        <h3 class="m-announcement-slideshow__title{% if block.settings.link != blank %} m-announcement-slideshow__title--linked{% endif %}">
                          {{ block.settings.title }}
                        </h3>
                      {% endif %}
                      
                      {% if block.settings.message != blank %}
                        <div class="m-announcement-slideshow__text">
                          {{ block.settings.message }}
                        </div>
                      {% endif %}
                      
                    </div>
                    
                    {% if block.settings.link != blank %}
                      </a>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
            
            {% if section.blocks.size > 1 %}
              <div class="m-announcement-slideshow__controls">
                {% if section.settings.show_arrows %}
                  <button class="m-announcement-slideshow__arrow m-announcement-slideshow__arrow--prev" aria-label="Previous slide">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="15,18 9,12 15,6"/>
                    </svg>
                  </button>
                  <button class="m-announcement-slideshow__arrow m-announcement-slideshow__arrow--next" aria-label="Next slide">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9,18 15,12 9,6"/>
                    </svg>
                  </button>
                {% endif %}
                
                {% if section.settings.show_dots %}
                  <div class="m-announcement-slideshow__dots">
                    {% for block in section.blocks %}
                      <button class="m-announcement-slideshow__dot{% if forloop.first %} active{% endif %}" 
                              data-slide="{{ forloop.index0 }}"
                              aria-label="Go to slide {{ forloop.index }}">
                      </button>
                    {% endfor %}
                  </div>
                {% endif %}
              </div>
            {% endif %}
          </div>
        </div>
        
        {% if section.settings.show_close %}
          <button class="m-announcement-slideshow__close" aria-label="Close announcement">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        {% endif %}
      </m-announcement-slideshow>
    </section>
  {% endif %}
{% endif %}

{% schema %}
{
  "name": "Announcement Slideshow",
  "settings": [
    {
      "type": "paragraph",
      "content": "Slideshow-style announcement bar with multiple promotional messages"
    },
    {
      "type": "header",
      "content": "General Settings"
    },
    {
      "type": "checkbox",
      "id": "show_slideshow",
      "label": "Show announcement slideshow",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "homepage_only",
      "label": "Homepage only",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_close",
      "label": "Show close button",
      "default": true
    },
    {
      "type": "select",
      "id": "container",
      "label": "Container type",
      "default": "container-fluid",
      "options": [
        {
          "value": "container-fluid",
          "label": "Default"
        },
        {
          "value": "w-full",
          "label": "Full width"
        },
        {
          "value": "container",
          "label": "Use container box"
        }
      ]
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme"
    },
    {
      "type": "header",
      "content": "Slideshow Settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Change slides every",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 5
    },
    {
      "type": "select",
      "id": "transition_effect",
      "label": "Transition effect",
      "default": "fade",
      "options": [
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "slide",
          "label": "Slide"
        },
        {
          "value": "slideUp",
          "label": "Slide up"
        }
      ]
    },
    {
      "type": "range",
      "id": "transition_duration",
      "label": "Transition duration",
      "min": 200,
      "max": 1000,
      "step": 100,
      "unit": "ms",
      "default": 500
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show navigation arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show dots indicator",
      "default": false
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "height",
      "label": "Slideshow height",
      "min": 40,
      "max": 120,
      "step": 2,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "height_mobile",
      "label": "Slideshow height (Mobile)",
      "min": 30,
      "max": 100,
      "step": 2,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "text_size_mobile",
      "label": "Text size (Mobile)",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom classes"
    }
  ],
  "blocks": [
    {
      "type": "slideshow_item",
      "name": "Slideshow Item",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Special Offer"
        },
        {
          "type": "textarea",
          "id": "message",
          "label": "Message",
          "default": "Get 20% off your first order with code WELCOME20"
        },
        {
          "type": "textarea",
          "id": "icon",
          "label": "Icon (SVG)",
          "info": "Optional SVG icon to display"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Slide link URL",
          "info": "Optional link - adds thin underline to text"
        },
        {
          "type": "color",
          "id": "background_color",
          "label": "Background color (optional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Announcement Slideshow",
      "category": "Promotional",
      "blocks": [
        {
          "type": "slideshow_item",
          "settings": {
            "title": "Free Shipping",
            "message": "Free shipping on all orders over $50"
          }
        },
        {
          "type": "slideshow_item",
          "settings": {
            "title": "New Collection",
            "message": "Discover our latest arrivals now available"
          }
        }
      ]
    }
  ]
}
{% endschema %}