{{ 'announcement-bar-ticker.css' | asset_url | stylesheet_tag }}
<script src="{{ 'announcement-bar-ticker.js' | asset_url }}" defer="defer"></script>

{% liquid
  assign container = section.settings.container
  if container == 'w-full'
    assign container = 'container-full'
  endif

  assign classes = 'm-section m-announcement-ticker'
  if section.settings.custom_class != blank
    assign classes = classes | append: ' ' | append: section.settings.custom_class
  endif
  assign classes = classes | append: ' m-gradient' | append: ' m-color-' | append: section.settings.color_scheme
%}

<style>
  #m-announcement-ticker--{{ section.id }} {
    --ticker-speed: {{ section.settings.speed }}s;
    --ticker-height: {{ section.settings.height }}px;
    --text-size: {{ section.settings.text_size }}px;
    --separator-spacing: {{ section.settings.separator_spacing }}px;
    --item-min-spacing: {{ section.settings.separator_spacing | divided_by: 2 }}px;
    {% if section.settings.separator_color != blank %}--separator-color: {{ section.settings.separator_color }};{% endif %}
  }
  @media (max-width: 767px) {
    #m-announcement-ticker--{{ section.id }} {
      --text-size: {{ section.settings.text_size_mobile }}px;
    }
  }
</style>

{% if section.settings.show_ticker %}
  {% if section.settings.homepage_only == false or request.page_type == 'index' %}
    <section
      id="m-announcement-ticker--{{ section.id }}"
      data-section-id="{{ section.id }}"
      data-section-type="announcement-ticker"
      class="{{ classes }}"
    >
      <m-announcement-ticker
        data-speed="{{ section.settings.speed }}"
        data-direction="{{ section.settings.direction }}"
        data-separator-type="{{ section.settings.separator_type }}"
        data-separator-custom="{{ section.settings.separator_custom }}"
      >
        <div class="{{ container }}">
          <div class="m-announcement-ticker__wrapper">
            <div class="m-announcement-ticker__content" data-ticker-content>
              {% for block in section.blocks %}
                <span class="m-announcement-ticker__item" data-ticker-item>
                  {% if block.settings.link != blank %}
                    <a href="{{ block.settings.link }}" class="m-announcement-ticker__link m-announcement-ticker__link--has-link">
                  {% endif %}
                  
                  {% if block.settings.message != blank %}
                    <span class="m-announcement-ticker__text{% if block.settings.link != blank %} m-announcement-ticker__text--linked{% endif %}">
                      {{ block.settings.message }}
                    </span>
                  {% endif %}
                  
                  {% if block.settings.link != blank %}
                    </a>
                  {% endif %}
                </span>
              {% endfor %}
            </div>
          </div>
        </div>
        
        {% if section.settings.show_close %}
          <button class="m-announcement-ticker__close" aria-label="Close announcement">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        {% endif %}
      </m-announcement-ticker>
    </section>
  {% endif %}
{% endif %}

{% schema %}
{
  "name": "Announcement Ticker",
  "settings": [
    {
      "type": "paragraph",
      "content": "Continuous scrolling ticker-style announcement bar"
    },
    {
      "type": "header",
      "content": "General Settings"
    },
    {
      "type": "checkbox",
      "id": "show_ticker",
      "label": "Show announcement ticker",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "homepage_only",
      "label": "Homepage only",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_close",
      "label": "Show close button",
      "default": true
    },
    {
      "type": "select",
      "id": "container",
      "label": "Container type",
      "default": "container-fluid",
      "options": [
        {
          "value": "container-fluid",
          "label": "Default"
        },
        {
          "value": "w-full",
          "label": "Full width"
        },
        {
          "value": "container",
          "label": "Use container box"
        }
      ]
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "select",
      "id": "direction",
      "label": "Direction",
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ]
    },
    {
      "type": "range",
      "id": "speed",
      "label": "Animation speed",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "s",
      "default": 30
    },
    {
      "type": "range",
      "id": "height",
      "label": "Ticker height",
      "min": 30,
      "max": 100,
      "step": 2,
      "unit": "px",
      "default": 50
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "text_size_mobile",
      "label": "Text size (Mobile)",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "header",
      "content": "Separator"
    },
    {
      "type": "select",
      "id": "separator_type",
      "label": "Separator style",
      "default": "dot",
      "options": [
        {
          "value": "dot",
          "label": "Dot (â€¢)"
        },
        {
          "value": "plus",
          "label": "Plus (+)"
        },
        {
          "value": "arrow",
          "label": "Arrow (â†’)"
        },
        {
          "value": "diamond",
          "label": "Diamond (â—†)"
        },
        {
          "value": "star",
          "label": "Star (â˜…)"
        },
        {
          "value": "pipe",
          "label": "Pipe (|)"
        },
        {
          "value": "slash",
          "label": "Slash (/)"
        },
        {
          "value": "heart",
          "label": "Heart (â™¥)"
        },
        {
          "value": "fire",
          "label": "Fire (ðŸ”¥)"
        },
        {
          "value": "lightning",
          "label": "Lightning (âš¡)"
        },
        {
          "value": "custom",
          "label": "Custom"
        }
      ]
    },
    {
      "type": "text",
      "id": "separator_custom",
      "label": "Custom separator",
      "default": "â€¢",
      "info": "Used when 'Custom' is selected above"
    },
    {
      "type": "range",
      "id": "separator_spacing",
      "label": "Separator spacing",
      "min": 10,
      "max": 80,
      "step": 2,
      "unit": "px",
      "default": 32
    },
    {
      "type": "color",
      "id": "separator_color",
      "label": "Separator color",
      "info": "Custom color for separators. Leave blank to use theme color."
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom classes"
    }
  ],
  "blocks": [
    {
      "type": "ticker_item",
      "name": "Ticker Item",
      "settings": [
        {
          "type": "textarea",
          "id": "message",
          "label": "Message",
          "default": "Free shipping on orders over $75"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link URL",
          "info": "Optional link - adds dashed underline to text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Announcement Ticker",
      "category": "Promotional",
      "blocks": [
        {
          "type": "ticker_item",
          "settings": {
            "message": "Free shipping on orders over $75"
          }
        },
        {
          "type": "ticker_item",
          "settings": {
            "message": "30-day returns on all items"
          }
        },
        {
          "type": "ticker_item",
          "settings": {
            "message": "24/7 customer support"
          }
        }
      ]
    }
  ]
}
{% endschema %}