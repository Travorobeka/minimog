{{ 'announcement-bar-social-proof.css' | asset_url | stylesheet_tag }}
<script src="{{ 'announcement-bar-social-proof.js' | asset_url }}" defer="defer"></script>

{% liquid
  assign container = section.settings.container
  if container == 'w-full'
    assign container = 'container-full'
  endif

  assign classes = 'm-section m-announcement-social-proof'
  if section.settings.custom_class != blank
    assign classes = classes | append: ' ' | append: section.settings.custom_class
  endif
  assign classes = classes | append: ' m-gradient' | append: ' m-color-' | append: section.settings.color_scheme
%}

<style>
  #m-announcement-social-proof--{{ section.id }} {
    --social-proof-height: {{ section.settings.height }}px;
    --text-size: {{ section.settings.text_size }}px;
    --notification-speed: {{ section.settings.notification_speed }}s;
  }
  @media (max-width: 767px) {
    #m-announcement-social-proof--{{ section.id }} {
      --social-proof-height: {{ section.settings.height_mobile }}px;
      --text-size: {{ section.settings.text_size_mobile }}px;
    }
  }
</style>

{% if section.settings.show_social_proof %}
  {% if section.settings.homepage_only == false or request.page_type == 'index' %}
    <section
      id="m-announcement-social-proof--{{ section.id }}"
      data-section-id="{{ section.id }}"
      data-section-type="announcement-social-proof"
      class="{{ classes }}"
    >
      <m-announcement-social-proof
        data-auto-rotate="{{ section.settings.auto_rotate }}"
        data-rotation-speed="{{ section.settings.notification_speed }}"
        data-animation="{{ section.settings.animation_type }}"
      >
        <div class="{{ container }}">
          <div class="m-announcement-social-proof__wrapper">
            
            {% if section.settings.static_content != blank %}
              <div class="m-announcement-social-proof__static">
                {% if section.settings.static_icon != blank %}
                  <span class="m-announcement-social-proof__static-icon">
                    {{ section.settings.static_icon }}
                  </span>
                {% endif %}
                <span class="m-announcement-social-proof__static-text">
                  {{ section.settings.static_content }}
                </span>
              </div>
            {% endif %}

            <div class="m-announcement-social-proof__notifications" data-notifications>
              {% for block in section.blocks %}
                <div class="m-announcement-social-proof__notification{% if forloop.first %} active{% endif %}"
                     data-notification="{{ forloop.index0 }}">
                  <div class="m-announcement-social-proof__notification-content">
                    {% if block.settings.avatar != blank %}
                      <div class="m-announcement-social-proof__avatar">
                        <img src="{{ block.settings.avatar | image_url: width: 40 }}" 
                             alt="{{ block.settings.customer_name | default: 'Customer' }}"
                             width="20" height="20" loading="lazy">
                      </div>
                    {% endif %}
                    
                    <div class="m-announcement-social-proof__notification-text">
                      {% case block.type %}
                        {% when 'purchase' %}
                          <span class="m-announcement-social-proof__message">
                            {% if block.settings.customer_name != blank %}
                              <strong>{{ block.settings.customer_name }}</strong>
                            {% else %}
                              <strong>Someone</strong>
                            {% endif %}
                            {% if block.settings.action_text != blank %}
                              {{ block.settings.action_text }}
                            {% else %}
                              just purchased
                            {% endif %}
                            {% if block.settings.product_name != blank %}
                              <strong>{{ block.settings.product_name }}</strong>
                            {% endif %}
                            {% if block.settings.location != blank %}
                              in {{ block.settings.location }}
                            {% endif %}
                          </span>
                          {% if block.settings.time_ago != blank %}
                            <span class="m-announcement-social-proof__time">{{ block.settings.time_ago }}</span>
                          {% endif %}
                        
                        {% when 'review' %}
                          <span class="m-announcement-social-proof__message">
                            {% if block.settings.customer_name != blank %}
                              <strong>{{ block.settings.customer_name }}</strong>
                            {% else %}
                              <strong>Someone</strong>
                            {% endif %}
                            gave
                            {% if block.settings.rating != blank %}
                              <span class="m-announcement-social-proof__rating">
                                {% for i in (1..5) %}
                                  <span class="m-announcement-social-proof__star{% if i <= block.settings.rating %} filled{% endif %}">â˜…</span>
                                {% endfor %}
                              </span>
                            {% endif %}
                            review
                            {% if block.settings.product_name != blank %}
                              for <strong>{{ block.settings.product_name }}</strong>
                            {% endif %}
                          </span>
                          {% if block.settings.time_ago != blank %}
                            <span class="m-announcement-social-proof__time">{{ block.settings.time_ago }}</span>
                          {% endif %}
                        
                        {% when 'visitor_count' %}
                          <span class="m-announcement-social-proof__message">
                            <strong>{{ block.settings.visitor_count | default: '12' }}</strong> people are viewing this page right now
                          </span>
                        
                        {% when 'stock_alert' %}
                          <span class="m-announcement-social-proof__message">
                            {% if block.settings.stock_count != blank %}
                              Only <strong>{{ block.settings.stock_count }}</strong> left
                            {% endif %}
                            {% if block.settings.product_name != blank %}
                              of <strong>{{ block.settings.product_name }}</strong>
                            {% endif %}
                            in stock!
                          </span>
                        
                        {% else %}
                          <span class="m-announcement-social-proof__message">
                            {{ block.settings.custom_message | default: 'Social proof notification' }}
                          </span>
                      {% endcase %}
                    </div>
                    
                    {% if block.settings.link != blank %}
                      <a href="{{ block.settings.link }}" class="m-announcement-social-proof__link" aria-label="View details"></a>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
            
            {% if section.settings.cta_text != blank and section.settings.cta_link != blank %}
              <div class="m-announcement-social-proof__cta">
                <a href="{{ section.settings.cta_link }}" class="m-announcement-social-proof__button btn btn--primary btn--small">
                  {{ section.settings.cta_text }}
                </a>
              </div>
            {% endif %}
          </div>
        </div>
        
        {% if section.settings.show_close %}
          <button class="m-announcement-social-proof__close" aria-label="Close announcement">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        {% endif %}
      </m-announcement-social-proof>
    </section>
  {% endif %}
{% endif %}

{% schema %}
{
  "name": "Announcement Social Proof",
  "settings": [
    {
      "type": "paragraph",
      "content": "Display live social proof notifications to build trust and urgency"
    },
    {
      "type": "header",
      "content": "General Settings"
    },
    {
      "type": "checkbox",
      "id": "show_social_proof",
      "label": "Show social proof announcements",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "homepage_only",
      "label": "Homepage only",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_close",
      "label": "Show close button",
      "default": true
    },
    {
      "type": "select",
      "id": "container",
      "label": "Container type",
      "default": "container-fluid",
      "options": [
        {
          "value": "container-fluid",
          "label": "Default"
        },
        {
          "value": "w-full",
          "label": "Full width"
        },
        {
          "value": "container",
          "label": "Use container box"
        }
      ]
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Auto-rotate notifications",
      "default": true
    },
    {
      "type": "range",
      "id": "notification_speed",
      "label": "Change notifications every",
      "min": 3,
      "max": 15,
      "step": 1,
      "unit": "s",
      "default": 6
    },
    {
      "type": "select",
      "id": "animation_type",
      "label": "Animation type",
      "default": "fadeInUp",
      "options": [
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "fadeInUp",
          "label": "Fade in up"
        },
        {
          "value": "slideIn",
          "label": "Slide in"
        }
      ]
    },
    {
      "type": "header",
      "content": "Static Content"
    },
    {
      "type": "textarea",
      "id": "static_content",
      "label": "Static text",
      "info": "Text that stays visible alongside rotating notifications"
    },
    {
      "type": "textarea",
      "id": "static_icon",
      "label": "Static icon (SVG)",
      "info": "Optional SVG icon for static content"
    },
    {
      "type": "header",
      "content": "Call to Action"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA button text"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "CTA button link"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "height",
      "label": "Bar height",
      "min": 50,
      "max": 100,
      "step": 2,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "height_mobile",
      "label": "Bar height (Mobile)",
      "min": 40,
      "max": 80,
      "step": 2,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Text size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "text_size_mobile",
      "label": "Text size (Mobile)",
      "min": 10,
      "max": 16,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom classes"
    }
  ],
  "blocks": [
    {
      "type": "purchase",
      "name": "Purchase Notification",
      "settings": [
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer name",
          "default": "Sarah M."
        },
        {
          "type": "text",
          "id": "action_text",
          "label": "Action text",
          "default": "just purchased"
        },
        {
          "type": "text",
          "id": "product_name",
          "label": "Product name",
          "default": "Premium T-Shirt"
        },
        {
          "type": "text",
          "id": "location",
          "label": "Location",
          "default": "New York"
        },
        {
          "type": "text",
          "id": "time_ago",
          "label": "Time ago",
          "default": "2 minutes ago"
        },
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Customer avatar"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Notification link"
        }
      ]
    },
    {
      "type": "review",
      "name": "Review Notification",
      "settings": [
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer name",
          "default": "Alex K."
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Star rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "text",
          "id": "product_name",
          "label": "Product name",
          "default": "Premium T-Shirt"
        },
        {
          "type": "text",
          "id": "time_ago",
          "label": "Time ago",
          "default": "5 minutes ago"
        },
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Customer avatar"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Notification link"
        }
      ]
    },
    {
      "type": "visitor_count",
      "name": "Visitor Count",
      "settings": [
        {
          "type": "text",
          "id": "visitor_count",
          "label": "Visitor count",
          "default": "47"
        }
      ]
    },
    {
      "type": "stock_alert",
      "name": "Stock Alert",
      "settings": [
        {
          "type": "text",
          "id": "stock_count",
          "label": "Stock count",
          "default": "3"
        },
        {
          "type": "text",
          "id": "product_name",
          "label": "Product name",
          "default": "Premium T-Shirt"
        }
      ]
    },
    {
      "type": "custom",
      "name": "Custom Notification",
      "settings": [
        {
          "type": "textarea",
          "id": "custom_message",
          "label": "Custom message",
          "default": "Join 10,000+ happy customers!"
        },
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Avatar image"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Notification link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Announcement Social Proof",
      "category": "Promotional",
      "settings": {
        "static_content": "ðŸ”¥ Limited Time Offer!"
      },
      "blocks": [
        {
          "type": "purchase",
          "settings": {
            "customer_name": "Emma S.",
            "product_name": "Premium Collection",
            "location": "California"
          }
        },
        {
          "type": "review",
          "settings": {
            "customer_name": "James L.",
            "product_name": "Premium Collection",
            "rating": 5
          }
        },
        {
          "type": "visitor_count",
          "settings": {
            "visitor_count": "23"
          }
        }
      ]
    }
  ]
}
{% endschema %}