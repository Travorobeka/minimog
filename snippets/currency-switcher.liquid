{%- liquid 
  unless form_id
    assign form_id = 'currency-form'
  endunless
  assign show_currency_selector = true
-%}

{% if show_currency_selector %}
  {% liquid
    assign min = 65
    assign max = 80
    assign diff = max | minus: min
    assign randomNumber = "now" | date: "%N" | modulo: diff | plus: min
    assign form_id = form_id | append: randomNumber
  %}
  {% if shop.enabled_currencies.size > 1 %}
    <div class="m-switcher-dropdown m-currency-switcher {{ box_size }}">
      {%- capture form_id -%}localization_form{{ product.id }}__{{ "now" | date: "%L" }}{%- endcapture -%}

      {% form 'localization', data-localization-form: '', id: form_id %}
        <input type="hidden" name="currency_code" value="{{ form.current_currency.iso_code }}" data-localization-input/>
        <m-select-component>
          <m-localization-form>
            <select class="js-selectNative" data-localization-select>
              {% assign unique_currencies = form.available_currencies | map: 'iso_code' | uniq %}
              {% for currency_code in unique_currencies %}
                {% for currency in form.available_currencies %}
                  {% if currency.iso_code == currency_code %}
                    <option
                        value="{{ currency.iso_code }}"
                        {% if form.current_currency.iso_code == currency.iso_code %}selected="selected"{% endif %}
                    >
                      {{ currency.iso_code }} {{ currency.symbol }}
                    </option>
                    {% break %}
                  {% endif %}
                {% endfor %}
              {% endfor %}
            </select>
          </m-localization-form>
          <div class="m-select-custom js-selectCustom" aria-hidden="true">
            <div class="m-select-custom--trigger">
              <span class="m-select-custom--trigger-text"></span>
              <span class="m-select-custom--trigger-icon">
                <svg fill="none" stroke="currentColor" stroke-width="1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="plus-icon">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
                </svg>
                <svg fill="none" stroke="currentColor" stroke-width="1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="minus-icon">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15"/>
                </svg>
              </span>
            </div>
            <div class="m-select-custom--options m-select-custom--options-{{ pos }}">
              {% assign unique_currencies = form.available_currencies | map: 'iso_code' | uniq %}
              {% for currency_code in unique_currencies %}
                {% for currency in form.available_currencies %}
                  {% if currency.iso_code == currency_code %}
                    <div class="m-select-custom--option" data-value="{{ currency.iso_code }}">{{ currency.iso_code }} {{ currency.symbol }}</div>
                    {% break %}
                  {% endif %}
                {% endfor %}
              {% endfor %}
            </div>
          </div>
        </m-select-component>
      {% endform %}
    </div>
  {% endif %}
{% endif %}
